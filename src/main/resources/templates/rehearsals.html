<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8"/>
  <title>Репетиции</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet"/>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</head>
<body>
<div class="container mt-4">
  <h1 class="mb-3">Репетиции</h1>

  <!-- Блок ошибки -->
  <div th:if="${param.error} == 'noRights'" class="alert alert-danger">
    У вас нет прав для добавления/редактирования репетиции.
  </div>
  <div th:if="${param.error} == 'notFound'" class="alert alert-danger">
    Репетиция не найдена.
  </div>

  <!-- Кнопка «Добавить новую» (показывать только admin/director) -->
  <div th:if="${canAdd}" class="mb-3">
    <a href="#" th:onclick="|window.location='@{/rehearsals/add}'|"
       class="btn btn-primary">Добавить репетицию</a>
    <!-- Здесь вы можете либо открывать форму добавления в модальном окне,
         либо направлять на отдельный эндпоинт /rehearsals/addForm -->
  </div>

  <!-- Таблица репетиций -->
  <div class="table-responsive">
    <table class="table table-bordered align-middle">
      <thead class="table-light">
      <tr>
        <th>Дата</th>
        <th>Время</th>
        <th>Зал</th>
        <th>Работники</th>
        <th>Комментарий</th>
        <th th:if="${canAdd}">Действия</th>
      </tr>
      </thead>
      <tbody>
      <tr th:each="r : ${rehearsals}">
        <td th:text="${r.date}">2025-06-02</td>
        <td th:text="${r.time}">18:30</td>
        <td th:text="${r.rehearsalRoom}">Зал 1</td>
        <td>
          <span th:each="w, st : ${r.workers}">
            <span th:text="${w.fio}">Иван Иванов</span><span th:if="${!st.last}">, </span>
          </span>
        </td>
        <td th:text="${r.comment}">Репетируют акт 1</td>

        <!-- Кнопки «Редактировать» / «Удалить» (только admin/director) -->
        <td th:if="${canAdd}">
          <div class="d-flex gap-2">
            <a th:href="@{'/rehearsals/edit/' + ${r.rehearsalId}}"
               class="btn btn-sm btn-warning">Редактировать</a>
            <form th:action="@{'/rehearsals/delete/' + ${r.rehearsalId}}" method="post"
                  onsubmit="return confirm('Удалить эту репетицию?');">
              <button type="submit" class="btn btn-sm btn-danger">Удалить</button>
            </form>
          </div>
        </td>
      </tr>
      <tr th:if="${#lists.isEmpty(rehearsals)}">
        <td colspan="6" class="text-center">Нет запланированных репетиций</td>
      </tr>
      </tbody>
    </table>
  </div>
</div>
</body>
</html>
