<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8"/>
  <title>Репетиции</title>
  <link
          href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
          rel="stylesheet"
  />
  <script
          src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"
  ></script>
</head>
<body>
<div class="container mt-4">
  <h1 class="mb-3">Репетиции</h1>

  <!-- Блок для вывода ошибки, если нет прав -->
  <div th:if="${param.error} == 'noRights'" class="alert alert-danger">
    У вас нет прав для добавления репетиции.
  </div>

  <!-- Форма добавления новой репетиции — видна только admin или director -->
  <div th:if="${canAdd}" class="card mb-4">
    <div class="card-body">
      <form th:action="@{/rehearsals/add}" method="post">
        <div class="row g-2 align-items-end">
          <div class="col-md-2">
            <label for="date" class="form-label">Дата</label>
            <input type="date" id="date" name="date" class="form-control" required/>
          </div>
          <div class="col-md-2">
            <label for="time" class="form-label">Время</label>
            <input type="time" id="time" name="time" class="form-control" required/>
          </div>
          <div class="col-md-2">
            <label for="room" class="form-label">Зал</label>
            <input type="text"
                   id="room"
                   name="room"
                   placeholder="Зал 1"
                   class="form-control"
                   required/>
          </div>
          <div class="col-md-4">
            <label for="workerIds" class="form-label">Работники</label>
            <select id="workerIds"
                    name="workerIds"
                    class="form-select"
                    multiple
                    required>
              <option th:each="w : ${allWorkers}"
                      th:value="${w.workerId}"
                      th:text="${w.fio}">Иван Иванов</option>
            </select>
            <div class="form-text">
              Удерживайте Ctrl (Cmd) для выбора нескольких работников.
            </div>
          </div>
          <div class="col-md-2 text-end">
            <button type="submit" class="btn btn-primary">Добавить</button>
          </div>
        </div>
      </form>
    </div>
  </div>

  <!-- Таблица: «Календарь репетиций» -->
  <div class="table-responsive">
    <table class="table table-bordered align-middle">
      <thead class="table-light">
      <tr>
        <th>Дата</th>
        <th>Время</th>
        <th>Зал</th>
        <th>Работники</th>
      </tr>
      </thead>
      <tbody>
      <!-- Если есть репетиции, выводим их -->
      <tr th:each="r : ${rehearsals}">
        <td th:text="${r.date}">2025-06-02</td>
        <td th:text="${r.time}">18:30</td>
        <td th:text="${r.rehearsalRoom}">Зал 1</td>
        <td>
                    <span th:each="w, iterStat : ${r.workers}">
                        <span th:text="${w.fio}">Иван Иванов</span>
                        <span th:if="${!iterStat.last}">, </span>
                    </span>
        </td>
      </tr>
      <!-- Если репетиций нет — показываем заглушку -->
      <tr th:if="${#lists.isEmpty(rehearsals)}">
        <td colspan="4" class="text-center">Нет запланированных репетиций</td>
      </tr>
      </tbody>
    </table>
  </div>
</div>
</body>
</html>
